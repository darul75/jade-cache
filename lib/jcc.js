/*! 
* @license jade-express - v0.0.1
* (c) 2013 Julien VALERY https://github.com/darul75/jcc
* License: MIT 
*/
!function(){var a={},b=require("fs"),c=(require("colors"),require("jade")),d=require("path");"undefined"!=typeof module&&module.exports&&(module.exports=a);var e,f={debug:!0,routes:["partials"],views:"views",exclude:[".svn",".DS_Store"],cache:"jade-compiled-templates"},g={},h=".jade";a.init=function(a,b,c){return a=a||{},j.extend(f,a),this.compileJadeTmpl(b),c()},a.handle=function(b,c,d){var e=a.options.routes,f=a.options.debug;if(b.app.enabled("jcc")){for(var g=0;g<e.length;g++)if(b.path.indexOf(e[g])<0)return d();f&&console.log("debug: using jcc for route: ".blue+b.path);try{if(!b.app.get(a.options.cache)[b.path])return f&&console.log("this route is not in cache".red+b.path),d();var h=b.app.get(a.options.cache)[b.path]();return c.send(h)}catch(i){throw Error("jade compiled view not found for path: "+b.path+" activate debug option first.")}}return d()},a.compileJadeTmpl=function(b){var c=(a.options.debug,d.resolve(b.get("views")));e=c,i(c),b.set(a.options.cache,g)};var i=function(f,j){var k,l=a.options.debug,m=b.readdirSync(f,"r");for(var n in m){var o=m[n],p=f+"/"+o,q=d.basename(p);if(!(a.options.exclude.indexOf(q)>=0)&&b.existsSync(p)){var r=b.statSync(p).isDirectory();if(r)j=j?o+"/":j+o+"/",i(p,j);else{if(d.extname(p)!==h){l&&console.log("debug: ".blue+o+" is not a jade file, might not be placed here.".blue);continue}try{k=c.compile(b.readFileSync(d.resolve(f,o),"utf8"),{filename:f+"/"+o});var s=p.replace(e,"").replace(h,"");l&&console.log("debug: file ".blue+o+" compiled, put in cache (key) route: ".blue+s),g[s]=k}catch(t){console.log("error while compiling".red+p.red)}}j=""}}j+="/"},j={extend:function(a,b){if(!b||"function"==typeof b)return a;for(var c in b)a[c]=b[c];return a}};a.functions=j,a.options=f}();